<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Payment Testing</title>
    <script src="https://checkout.razorpay.com/v1/checkout.js"></script>
</head>
<body>
    <h1>Payment Testing</h1>
    <button id="initiatePayment">Initiate Payment</button>
    <div id="paymentStatus"></div>

    <script>
        const initiatePaymentBtn = document.getElementById('initiatePayment');
        const paymentStatus = document.getElementById('paymentStatus');

        initiatePaymentBtn.addEventListener('click', async () => {
            try {
                // Initiate Payment
                const response = await fetch('http://localhost:5000/v1/payment/initiate', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                        'Authorization': 'Bearer eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJlbWFpbCI6ImhlbGxvQGdtYWlsLmNvbSIsInN0dWRlbnRJZCI6IjY3ZmZmNjRkOWJhMGI3NTljYjZkZmMxZiIsImlhdCI6MTc0NDg4ODcyMCwiZXhwIjoxNzQ1NDkzNTIwfQ.mF-TOM5KI1l4LyivHyJqjFVkoVD6Oou8apv8DrJRKNs' // Replace with actual token
                    }
                });
                const data = await response.json();
                console.log(data);
                
                if (data.success) {
                    const options = {
                        key: data.data.key,
                        amount: data.data.amount * 100, // Amount in paise
                        currency: data.data.currency,
                        name: 'Test Payment',
                        description: 'Test Transaction',
                        order_id: data.data.orderId,
                        handler: async function (response) {
                            // Verify Payment
                            const verifyResponse = await fetch('http://localhost:5000/v1/payment/verify', {
                                method: 'POST',
                                headers: {
                                    'Content-Type': 'application/json',
                                    'Authorization': 'Bearer eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJlbWFpbCI6ImhlbGxvQGdtYWlsLmNvbSIsInN0dWRlbnRJZCI6IjY3ZmZmNjRkOWJhMGI3NTljYjZkZmMxZiIsImlhdCI6MTc0NDg4ODcyMCwiZXhwIjoxNzQ1NDkzNTIwfQ.mF-TOM5KI1l4LyivHyJqjFVkoVD6Oou8apv8DrJRKNs' // Replace with actual token
                                },
                                body: JSON.stringify({
                                    paymentId: response.razorpay_payment_id,
                                    orderId: response.razorpay_order_id,
                                    signature: response.razorpay_signature
                                })
                            });
                            const verifyData = await verifyResponse.json();
                            paymentStatus.innerText = `Payment Status: ${verifyData.status}`;
                        },
                        prefill: {
                            name: 'Test User',
                            email: 'test@example.com',
                            contact: '9999999999'
                        },
                        notes: {
                            address: 'Test Address'
                        },
                        theme: {
                            color: '#3399cc'
                        }
                    };

                    const rzp = new Razorpay(options);
                    rzp.open();
                } else {
                    paymentStatus.innerText = 'Failed to initiate payment';
                }
            } catch (error) {
                paymentStatus.innerText = `Error: ${error.message}`;
            }
        });
    </script>
</body>
</html>